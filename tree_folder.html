<!DOCTYPE html>
<html>
  <head>
    <title>Folder Structure Tree</title>
    <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />
    <style>
      .folder {
        border: 1px solid #ccc;
        padding: 5px;
        margin: 5px;
      }
      .file {
        margin: 5px;
      }
    </style>
  </head>
  <body>
    <br /><br />
    <input type="text" id="fileNameInput" placeholder="Enter file name" />
    <button class="add-button" onclick="addFile()">Add File</button>
    <input type="text" id="folderNameInput" placeholder="Enter folder name" />
    <button class="add-button" onclick="addFolder()">Add Folder</button>
    <br /><br />
    <div id="folderTree"></div>

    <script>
      const folderStructure = {
        name: "Root",
        type: "folder",
        children: [
          {
            name: "Folder 1",
            type: "folder",
            children: [
              { name: "File 1.txt", type: "file" },
              { name: "File 2.txt", type: "file" },
            ],
          },
          {
            name: "Folder 2",
            type: "folder",
            children: [{ name: "File 3.txt", type: "file" }],
          },
        ],
      };

      function createTreeElement(item) {
        const element = document.createElement("div");

        // Create icon for the item
        const icon = document.createElement("i");
        if (item.type === "folder") {
          icon.className = "fas fa-folder";
          // Add click event for folder to toggle expand/collapse
          icon.addEventListener("click", function () {
            toggleFolder(item);
          });
        } else {
          icon.className = "fas fa-file";
        }
        element.appendChild(icon);

        // Create text content for the item
        const text = document.createElement("span");
        text.textContent = item.name;
        // Add click event to select folder
        text.addEventListener("click", function () {
          selectFolder(element);
        });
        element.appendChild(text);

        // Create delete button for the item (if it's a file)
        if (item.type === "file") {
          const deleteButton = document.createElement("button");
          deleteButton.textContent = "Delete File";
          deleteButton.onclick = function () {
            deleteItem(item);
          };
          element.appendChild(deleteButton);
        }

        // Create delete button for the item (if it's a folder)
        if (item.type === "folder") {
          const deleteButton = document.createElement("button");
          deleteButton.textContent = "Delete Folder";
          deleteButton.onclick = function () {
            deleteItem(item);
          };
          element.appendChild(deleteButton);
          element.addEventListener("dragover", allowDrop);
          element.addEventListener("drop", function (event) {
            dropFile(event, item);
          });
        } else {
          element.draggable = true;
          element.addEventListener("dragstart", function (event) {
            drag(event, item);
          });
        }

        // Add CSS class
        element.classList.add("tree-element");
        element.classList.add(item.type);
        if (item.type === "folder") {
          element.classList.add("folder"); // Add 'folder' class specifically for folders
        }

        // Add children recursively (if it's a folder and has children)
        if (item.type === "folder" && item.children) {
          item.children.forEach((child) => {
            const childElement = createTreeElement(child);
            element.appendChild(childElement);
          });
        }

        return element;
      }

      // Function to toggle folder expansion/collapse
      function toggleFolder(folder) {
        folder.isExpanded = !folder.isExpanded;
        updateFolderTree();
      }

      function deleteItem(item) {
        const parent = findParent(folderStructure, item);
        if (parent) {
          parent.children = parent.children.filter((child) => child !== item);
          updateFolderTree();
          window.alert("Item deleted successfully.");
        }
      }

      function findParent(root, target) {
        if (root.children && root.children.includes(target)) {
          return root;
        } else if (root.children) {
          for (const child of root.children) {
            const parent = findParent(child, target);
            if (parent) {
              return parent;
            }
          }
        }
        return null;
      }

      function addFile() {
        const fileNameInput = document.getElementById("fileNameInput");
        const fileName = fileNameInput.value.trim();
        if (fileName !== "") {
          promptFolderSelection(function (selectedFolder) {
            if (selectedFolder) {
              addFileToFolder(selectedFolder, fileName);
              fileNameInput.value = "";
            } else {
              alert("Folder not found.");
            }
          });
        }
      }

      function addFolder() {
        const folderNameInput = document.getElementById("folderNameInput");
        const folderName = folderNameInput.value.trim();
        if (folderName !== "") {
          addFolderToFolder(folderStructure, folderName);
          folderNameInput.value = "";
        }
      }

      function addFileToFolder(parentFolder, fileName) {
        const file = { name: fileName, type: "file" };
        parentFolder.children.push(file);
        updateFolderTree();
      }

      function addFolderToFolder(parentFolder, folderName) {
        const folder = { name: folderName, type: "folder", children: [] };
        parentFolder.children.push(folder);
        updateFolderTree();
      }

      function updateFolderTree() {
        folderTree.innerHTML = "";
        const treeElement = createTreeElement(folderStructure);
        folderTree.appendChild(treeElement);
      }

      function promptFolderSelection(callback) {
        const folderName = prompt(
          "Enter the name of the folder to add the file to:"
        );
        if (folderName !== null) {
          const selectedFolder = findFolderByName(folderStructure, folderName);
          callback(selectedFolder);
        }
      }

      function findFolderByName(parentFolder, folderName) {
        if (
          parentFolder.name === folderName &&
          parentFolder.type === "folder"
        ) {
          return parentFolder;
        } else if (parentFolder.children) {
          for (const child of parentFolder.children) {
            const foundFolder = findFolderByName(child, folderName);
            if (foundFolder) {
              return foundFolder;
            }
          }
        }
        return null;
      }

      function selectFolder(folderElement) {
        const selectedElements = document.querySelectorAll(".selected");
        selectedElements.forEach((element) => {
          element.classList.remove("selected");
        });
        folderElement.classList.add("selected");
      }

      function allowDrop(event) {
        event.preventDefault();
      }

      function drag(event, item) {
        event.dataTransfer.setData("text", item.name);
      }

      function dropFile(event, targetFolder) {
        event.preventDefault();
        const fileName = event.dataTransfer.getData("text");
        const file = { name: fileName, type: "file" };
        targetFolder.children.push(file);
        const parentFolder = findParent(folderStructure, fileName);
        if (parentFolder) {
          parentFolder.children = parentFolder.children.filter(
            (child) => child.name !== fileName
          );
          updateFolderTree();
        }
      }

      const folderTree = document.getElementById("folderTree");
      const treeElement = createTreeElement(folderStructure);
      folderTree.appendChild(treeElement);

      function dropFile(event, targetFolder) {
        event.preventDefault();
        const fileName = event.dataTransfer.getData("text");
        const file = { name: fileName, type: "file" };

        // Find the target folder by its name
        const parentFolder = findParent(folderStructure, fileName);

        if (parentFolder) {
          // Remove the file from the original folder
          parentFolder.children = parentFolder.children.filter(
            (child) => child.name !== fileName
          );

          // Add the file to the target folder
          targetFolder.children.push(file);

          // Update the folder tree
          updateFolderTree();
        } else {
          // If the file is not found in any existing folder, it might be a dragged file from outside
          // In this case, we add the file directly to the target folder
          targetFolder.children.push(file);
          updateFolderTree();
        }
      }
    </script>
  </body>
</html>
